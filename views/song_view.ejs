<% include partials/header %>

<link href="css/login.css" rel="stylesheet" type="text/css">


<div class="container">
	<div class="alert alert-success">
		<form action="/back" method="POST">
			<button class="btn btn-outline-success my-2 my-sm-0" role="button" >Search Again!</button>	
		</form>
	</div>
</div>


<div class = "audio-player-cont">
	<div class='logo'>
	<img id = "thumb" src="images/nothing.png" style="height:130px; width:130px; border:5px;" />
</div>
<div class = "player">
	<div id ="songTitle" class = "song-title"> My Song title will go here</div>
	<input id="songSlider" class="song-slider" type="range" min="0" step="1" onchange= "seekSong()" />
	<div>
		<div id= "currentTime" class= "current-time"> 00::00</div>
		<div id= "duration" class= "duration"> 00::00</div>

	</div>
	<div class="controllers">
		<img src = "images/previous.png" width ="30px" onclick= "previous();" />
		<img src = "images/backward.png" width ="30px" onclick= "decreasePlaybackRate();" />
		<img src = "images/play.png" width ="30px" onclick= "playOrPauseSong();" />
		<img src = "images/forward.png" width ="30px" onclick= "increasePlaybackRate();" />
		<img src = "images/next.png" width ="30px" onclick= "next();" />
		<img src = "images/volume-down.png" width ="15px" />
		<input id = "volumeSlider" class="volume-slider" type = "range" min="0" max="1" step="0.01" onchange="adjustVolume();" />
		<img src = "images/volume-up.png" width ="15px" style="margin-left: 2px" />
	</div>
	<div id="nextSongTitle" class="song-title"><b>Next Song: </b>Next Song Title goes here</div>
</div>
</div>






<div class="container">

	<h2><%=Playlist.name%></h2>


    <% Playlist.playlist.forEach(function(song) { %>
        <img id="songaudio" src="clearspace.gif"  style="height:0px; width:0px; border:0px;" data-link1 = <%=song["audio"]%>>
        <img id="songname" src="clearspace.gif"  style="height:0px; width:0px; border:0px;" data-link2 = <%=song["name"]%>>
        <img id="songimage" src="clearspace.gif"  style="height:0px; width:0px; border:0px;" data-link3 = <%=song["image"]%>>

        <%});%>
	

    <div class="row row-cols-1 row-cols-md-3">
        <% Playlist.playlist.forEach(function(song) { %>
            
            <div class="col mb-4">
                <div class="card-transparent h-100">
                    <img src="<%=song["image"] %>" class="card-img-top" alt="...">
                    <div class="card-body">
						<h4 class="card-title"><strong><%= song["name"] %></strong></h4>
						<p class="card-text"><%=song["artist"]%></p>
						<form action=/playsong/<%=Playlist._id %>/<%=song._id %> method="GET">
							<input class="btn btn-outline-success my-2 my-sm-0" role="button" type="submit" value="play">
						</form>
						<br>
						<form action="delsong/<%=Playlist._id %>/<%=song._id %>_method=DELETE"  method="POST">	
							<input class="btn btn-outline-danger" role="button" type="submit" value="DELETE">
						</form>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</div>
//
<script>
    var currentSong = 0;
    var songaud=[];
    var playlist1;
    var songname=[];
    var songimg=[];
    
    $( "#songaudio" ).ready(function(){
        const div2 = document.getElementById('songaudio');

        songaud[currentSong]= div2.dataset.link1;});


        $( "#songname" ).ready(function(){
        const div2 = document.getElementById('songname');

        songname[currentSong]= div2.dataset.link2;});

        $( "#songimage" ).ready(function(){
        const div2 = document.getElementById('songimage');

        songimg[currentSong]= div2.dataset.link3;});

    currentSong = 0;


    
    var songTitle = document.getElementById('songTitle');
    var songSlider = document.getElementById('songSlider');
    var currentTime = document.getElementById('currentTime');
    var duration = document.getElementById('duration');
    var volumeSlider = document.getElementById('volumeSlider');
    var nextSongTitle = document.getElementById('nextSongTitle');
    var thumb = document.getElementById('thumb');

    
    var song;
    
    window.onload = loadSong;
    
    function playCurrent(){
        
    
        loadSong();
    }
    
    function loadSong(){
        song=new Audio(songaud[currentSong]);
        songTitle.textContent = songname[currentSong];
        thumb.src = songimg[currentSong];
        nextSongTitle.innerHTML = "<b>Next Song: </b>" + songname[currentSong + 1 % songaud.length];
        song.playbackRate=1;
        song.volume = volumeSlider.value;
        showDuration();
        song.play();
    }
    
    setInterval(updateSongSlider, 1000);
    
    function updateSongSlider(){
        var c = Math.round(song.currentTime);
        songSlider.value = c;
        currentTime.textContent = convertTime(c);
        if(song.ended){
            next();
        }
    }
    
    function convertTime(secs){
        var min = Math.floor(secs/60);
        var sec = secs%60;
        min = (min < 10)? "0" + min : min;
        sec = (sec <10)? "0" + sec : sec;
        return(min + ":" + sec);
    }
    
    function showDuration(){
        var d = Math.floor(song.duration);
        console.log(d);
        songSlider.setAttribute("max", d);
        duration.textContent = convertTime(d);
    }
    
    function playOrPauseSong(img){
        song.playbackRate=1;
        if(song.paused){
            song.play();
            img.src="images/pause.png";
         }
         else{
             song.pause();
            img.src="images/play.png";
         }
    }
    
    
    function next(){
        currentSong = currentSong + 1 % songaud.length;
        loadSong();
    }
    
    function previous(){
        currentSong--;
        currentSong = (currentSong < 0) ? songaud.length -1 : currentSong;
        loadSong();
    }
    function seekSong(){
        song.currentTime = songSlider.value;
        currentTime.textContent = convertTime(song.currentTime);
    
    }
    
    function adjustVolume(){
        song.volume = volumeSlider.value;
    }
    
    function increasePlaybackRate(){
        song.playbackRate += 0.5;
    }
    
    
    function decreasePlaybackRate(){
        song.playbackRate -= 0.5;
    }
    
    
    </script>

    
  

<% include partials/footer %>

